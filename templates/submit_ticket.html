{% extends "base.html" %}

{% block title %}ZENTRA - Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©{% endblock %}

{% block page_title %}Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©{% endblock %}

{% block extra_head %}
<style>
/* Form Card */
.form-card {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    padding: 40px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    max-width: 700px;
    margin: 0 auto;
    animation: fadeInUp 0.6s ease forwards;
}

.form-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    text-align: center;
    font-family: 'Cairo', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.form-title::before {
    content: 'ğŸ“';
    font-size: 32px;
}

.form-subtitle {
    color: var(--text-secondary);
    font-size: 16px;
    text-align: center;
    margin-bottom: 30px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
}

/* Form Styles */
.form-group {
    margin-bottom: 25px;
}

.form-label {
    display: block;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 14px;
    font-family: 'Cairo', sans-serif;
}

.required {
    color: #ef4444;
    margin-right: 4px;
    font-weight: 700;
}

.form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    font-size: 14px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
    transition: var(--transition-fast);
    text-align: right;
    direction: rtl;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(45, 55, 72, 0.1);
}

select.form-control {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: left 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-left: 40px;
}

textarea.form-control {
    resize: vertical;
    min-height: 120px;
}

textarea.form-control::placeholder {
    color: var(--text-muted);
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
}

/* File Input */
.file-input-wrapper {
    position: relative;
    display: block;
    cursor: pointer;
    width: 100%;
}

.file-input-hidden {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-input-display {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    border: 2px dashed var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
    transition: var(--transition-normal);
    min-height: 80px;
    direction: rtl;
    gap: 12px;
}

.file-input-wrapper:hover .file-input-display {
    border-color: var(--primary-color);
    background: var(--primary-light);
}

.file-icon {
    font-size: 20px;
    color: var(--text-secondary);
}

.file-text {
    color: var(--text-secondary);
    font-size: 14px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
}

.file-selected .file-text {
    color: var(--primary-color);
    font-weight: 700;
}

.file-selected .file-input-display {
    border-color: #4a5568;
    background: var(--success-light);
}

/* Buttons */
.button-group {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.btn {
    flex: 1;
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: 'Cairo', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn:disabled {
    background: var(--text-muted);
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: var(--bg-primary);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    min-width: 120px;
    flex: none;
    text-decoration: none;
}

.btn-secondary:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--border-dark);
}

/* Loading state */
.btn.loading {
    opacity: 0.8;
    cursor: not-allowed;
}

.btn.loading::after {
    content: '';
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 8px;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Responsive */
@media (max-width: 768px) {
    .form-card {
        padding: 30px 20px;
    }

    .form-title {
        font-size: 24px;
    }

    .button-group {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
    <!-- Form Card -->
    <div class="form-card">
        <h1 class="form-title">Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h1>
        <p class="form-subtitle">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¯Ø¹Ù… ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯</p>

        <form action="{{ url_for('submit_ticket') }}" method="post" enctype="multipart/form-data" id="ticketForm">
            <div class="form-group">
                <label for="category" class="form-label">Ø§Ù„ÙØ¦Ø© <span class="required">*</span></label>
                <select name="category" id="category" class="form-control" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© --</option>
                    <option value="Ø­Ø§Ø³Ø¨">Ø­Ø§Ø³Ø¨</option>
                    <option value="Ø­ØµÙ„">Ø­ØµÙ„</option>
                    <option value="Ù…ÙƒØ§Ù„Ù…Ø§Øª">Ù…ÙƒØ§Ù„Ù…Ø§Øª</option>
                    <option value="Ø§Ù„Ø´Ø¨ÙƒØ©">Ø§Ù„Ø´Ø¨ÙƒØ©</option>
                    <option value="Ø§ÙŠÙ…ÙŠÙ„">Ø§ÙŠÙ…ÙŠÙ„</option>
                    <option value="Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ©">Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ©</option>
                    <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                </select>
            </div>

            <div class="form-group">
                <label for="description" class="form-label">Ø§Ù„ÙˆØµÙ <span class="required">*</span></label>
                <textarea
                    name="description"
                    id="description"
                    rows="6"
                    class="form-control"
                    placeholder="ÙŠØ±Ø¬Ù‰ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„ØªÙØµÙŠÙ„. ÙƒÙ„Ù…Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆØµÙ Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©ØŒ ÙƒÙ„Ù…Ø§ ØªÙ…ÙƒÙ†Ø§ Ù…Ù† Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„..."
                    required
                ></textarea>
            </div>

            <div class="form-group">
                <label for="file" class="form-label">Ù…Ø±ÙÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <div class="file-input-wrapper">
                    <input 
                        type="file" 
                        name="file" 
                        id="file" 
                        class="file-input-hidden"
                        accept="image/*,.pdf,.doc,.docx,.txt,.zip" 
                        capture="environment"
                    />
                    <div class="file-input-display">
                        <i class="fas fa-cloud-upload-alt file-icon"></i>
                        <span class="file-text">Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§</span>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn" id="submitBtn">
                    <i class="fas fa-paper-plane"></i>
                    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø©
                </button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Ø¥Ù„ØºØ§Ø¡
                </a>
            </div>
        </form>
    </div>
{% endblock %}

{% block extra_scripts %}
<script>
    // File input functionality
    document.getElementById('file').addEventListener('change', function(e) {
        const fileDisplay = document.querySelector('.file-text');
        const wrapper = document.querySelector('.file-input-wrapper');
        
        if (e.target.files.length > 0) {
            const fileName = e.target.files[0].name;
            fileDisplay.innerHTML = `<i class="fas fa-check-circle"></i> ${fileName}`;
            wrapper.classList.add('file-selected');
        } else {
            fileDisplay.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Ø§Ù†Ù‚Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§';
            wrapper.classList.remove('file-selected');
        }
    });

    // Form submission
    const form = document.getElementById('ticketForm');
    form.addEventListener('submit', function(e) {
        const category = document.getElementById('category').value;
        const description = document.getElementById('description').value;
        
        if (!category || !description.trim()) {
            e.preventDefault();
            alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
            return;
        }
        
        // Show loading state
        const submitButton = document.getElementById('submitBtn');
        submitButton.classList.add('loading');
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        submitButton.disabled = true;
    });

    // Drag and drop functionality
    const fileInputWrapper = document.querySelector('.file-input-wrapper');
    const fileInput = document.getElementById('file');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileInputWrapper.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        fileInputWrapper.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        fileInputWrapper.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        fileInputWrapper.querySelector('.file-input-display').style.borderColor = 'var(--primary-color)';
        fileInputWrapper.querySelector('.file-input-display').style.background = 'var(--primary-light)';
    }

    function unhighlight(e) {
        fileInputWrapper.querySelector('.file-input-display').style.borderColor = 'var(--border-color)';
        fileInputWrapper.querySelector('.file-input-display').style.background = 'var(--bg-secondary)';
    }

    fileInputWrapper.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            fileInput.files = files;
            const event = new Event('change');
            fileInput.dispatchEvent(event);
        }
    }
</script>
{% endblock %}